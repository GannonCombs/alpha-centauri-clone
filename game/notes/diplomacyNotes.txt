Flow for diplomacy activation and dialog tree:

Edit: some of the below is outdated. Will try to update this later.
faction_id is the current faction. 0-6, based on FACTIONS index.
player_faction_id is my faction.
I think there's something called ai_factions now.
faction_assignments is gone.
_assign_factions is gone.
player_id is gone.
unit.owner used to be weird. it's just faction_id now.


1 Try to move a unit: game.try_move_unit(self, unit, target_x, target_y).
 - Poorly named. It DOES move a unit if it can.
2 After it moves, but still within try_move_unit, we call game._check_first_contact.
3 Within, we set game.pending_commlink_requests. Each entry in this list contains player_id and other_faction_id.
 - Fishy smell: self.faction_contacts.append(other_faction_id)
 - Fishy smell: # Check if we have all living factions now
 - This looks, at the very least, duplicated unnecessarily. But it might be in the wrong function.
4 ui_manager.draw checks if it needs to draw a commlink request popup.
5 If it does, ui_manager._draw_commlink_request draws a dialog box that says "x is requesting to speak with you." "A representative wishes to open communications."
6 Clicking Answer triggers this conditional earlier in ui_manager: if self.commlink_request_answer_rect and self.commlink_request_answer_rect.collidepoint(pos):
 - This opens up the diplomacy view, I think: self.active_screen = "DIPLOMACY"
 - Note the values passed in. It's getting an other_faction_id.
 - Ok there's something possibly weird going on here. pending_commlink_requests is an array, because you can meet multiple new factions with one move. It's happened.
 - But when we pass it in, we store the data globally. Is this necessary? In some order...
 - On line 886 of ui_manager.draw, we store the two ids.
 - The global variable is used in ui_manager._draw_commlink_request
 - The global variable is used when Answer is clicked
 - So it definitely looks weird that the pop (and loss of data) is occurring right next to where most of the ids are being used. But maybe we can't pass the data through.
 - Line 379 is REALLY smelly. Even if the two ids DO need to be global, this looks wrong. TODO: Solve this.
 - Other fishy smell: self.diplomacy.diplo_stage = "greeting"
 - This sets diplo_stage in the ui_manager. I can't see any need for this in ui_manager, or anywhere it's used.
7 These are passed to diplomacy.open_diplomacy.
  - This seems to only set variables.
 - Other diplomacy.py functions? TBD. TODO: Solve this.
 - Trace backwards from below to try to connect the dots.
8 commlink_text.py functions
 - class DialogSubstitution (imported in diplomacy.py) contains the following functions:
 -get_dialog()...gets dialog. It calls set_context().
 -set_context()...sets the context (meaning flavor text)
 - Remember, commlink_dialogs ONLY sets the text.







