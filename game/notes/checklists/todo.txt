***************************************************************************

** Beta test **

***************************************************************************


The following are features I added or bugs I fixed but haven't tested to ensure correctness.

✅ When subtask completed, erase when entire feature/bug has been confirmed working correctly.



Features:



1. I created a debug mode to be able to test anything.
Use it to test the following issues, but also test debug mode along the way.

2. Energy Allocation System
- Split energy production between Economy, Labs, and Psych ✅
- Economy → Energy reserves (treasury) ✅
- Labs → Research speed
- Psych → Talent creation (happiness) ✅
- Adjustable slider/percentage allocation ✅

3. Psych, Drones, and Talents System
- Drones = unhappy citizens (appear based on difficulty and base size) ✅
- Talents = happy citizens (created via Psych allocation or facilities) ✅
- Drone Riots occur when Drones > Talents (production stops)
- Facilities like Recreation Commons reduce drones
- Police units can suppress drones (based on POLICE social engineering)

4. Unit Support & Maintenance
- Units cost minerals to support (based on SUPPORT social engineering)
- Free support levels (2 units per base by default)
- Exceeding support level drains minerals from production
- "Clean Reactor" ability eliminates support costs

5. Air Units & Fuel/Range
- Air units have limited range (must return to base/airbase)
- Range measured in turns from base
- Needlejets: 2 turn range, Copters: 1 turn range
- Airbases allow refueling
- Air superiority combat (+100% vs. air, -50% vs. ground)

6: Special Unit Abilities

- Clean Reactor: No support cost
- AAA Tracking: +100% vs air units
- Comm Jammer: +50% attack
- Blink Displacer: Ignores base defense
- Empath Song: +50% vs psi armor
- Framework ready for Cloaking, Drop Pods, Amphibious Pods, Fungal Payload

7. Probe Teams
- Infiltrate datalinks
- Steal technology
- Sabotage facilities
- Incite drone riots
- Mind control units/bases
- Success rate based on PROBE social engineering
- Every successful action leads to a morale upgrade, until Elite

8: Sea Transport & Loading

- Transport foils can carry up to 4 land units, Transport cruisers up to 8. ✅
- Loaded units move with transport automatically ✅
- Unload to adjacent land tiles ✅
- Loaded units destroyed if transport is destroyed while not in base.
- When a unit is in a base along with a transport, press l to load them.

9: Disengage Mechanic

- Fast units can escape when damaged to 50% or less HP
- Requires 2+ movement advantage over opponent
- Success chance: 50% base + morale bonuses + speed bonuses
- Units retreat to safe adjacent tiles

10: Base Conquest (Disloyal Citizens)                                                              ─

- Captured bases have disloyal citizens for 50 turns
- Formula: 5 - (turns_since_capture // 10), capped by base size
- Extra drones make conquered bases harder to manage
- Works with both combat conquest and probe mind control

11: Planetary Council Proposals

- Added ALL proposals ✅
- Voting UI fully functional
- Effects implemented (some stubbed for future work)

12: Victory Conditions

- Conquest: Eliminate all enemies
- Diplomatic: Win vote for Supreme Leader
- Economic: 50k credits + Economic Victory project
- Transcendence: Complete Ascent to Transcendence

13: Artillery
- Right click
- Some hot key also activates

14: Remaining Faction bonuses to test
Faction: Deirdre
Bonus: fungus_nutrients: 1 — Get +1 nutrient per worked fungus tile
Location: calculate_resource_output
────────────────────────────────────────
Faction: Zakharov
Bonus: extra_drone_per_4 — +floor(pop/4) extra drones
Location: calculate_population_happiness
────────────────────────────────────────
Faction: Morgan
Bonus: hab_complex_limit: 4 — can't exceed pop 4 without hab complex
Location: _get_max_pop
────────────────────────────────────────
Faction: Lal
Bonus: hab_complex_bonus: 2 — +2 to all population caps
Location: _get_max_pop
The _get_max_pop now reads both hab_complex_limit (replaces default 7) and hab_complex_bonus
(additive to all tiers), so Morgan caps at 4 / 14, and Lal caps at 9 / 16.

15 Once we get the commlink of every living faction, give a popup that we now have them all, and thus can now call council.

16 If another unit gets all contacts first, they may call council. Add to the AI behavior that encourages them to call things
that they like. Examples: remove atrocity prohibitions if their faction is warlike, elect governor if they are a candidate, etc.

17: Artifacts
- If an artifact walks onto a square that is adjacent to an enemy, a popup occurs that the artifact was stolen. Ok button.
The artifact transports to the title the unit was on.
- If an artifact is on the same title as a military unit, and another faction kills that unit, the artifact gets taken
in similar fashion. Note that if the tile has multiple units on it, the artifact stays put. Only transfers on the last death.
- If an artifact moves onto a supply pod, both artifact and pod are consumed. No tech comes of it. Have a popup saying
the artifact was destroyed. Ok button only.
- If an artifact is held in a base with an unlinked Network Node, a popup occurs, asking if we'd like to link it.
If yes, the artifact is consumed and we get a free tech. Linking means a network node can only consume one artifact ever.

18: Bonus techs
- The first person to discover any of the three techs starting with "Secrets of" get another tech right after.



Bugs:



1 A unit of mine took a base and wasn't healed. Any unit taking a base automatically fully heals.
2 Saw an AI unit on an island tile it couldn't have walked to, before getting a transport. They were on the bottom row
of the map; are there invisible tiles there that are playable?
3 Got a diplomatic milestone popup when missing commlinks.
4 Healing should not occur at turn end. It happens in upkeep of the next turn.
5 Production times are off. Merchant Exchange takes 20 turns on Turn 1 for Morgan.
6 Healing isn't working correctly. It's applying the bonuses correctly, but when the units are moving. It should only
be when they've skipped their turn entirely. If a unit has even partially moved or acted that turn, healing doesn't happen
naturally (movement onto a monolith is the exception.)
7 Turn auto-ended when the last unit moved into contact with a new faction. End turn needs to wait for diplomacy to finish.
The End Turn button should then blink, not auto-end.
8 Alien artifact in base with network node — no popup appeared. Now triggers on unit selection.
    Updated popup: "What would you like to do?" with "Link to Network Node" / "Keep for later".
9 Land unit in sea base could walk directly to adjacent land tile. Should be blocked unless amphibious or there's a transport.
10 The selecting and de-selecting of the tiles the base works in the mini-map is broken. De-selection should not automatically
re-select. The user will click once to de-select, and click a non-worked tile to select. The user can also de-select multiple
tiles in a row before selecting new ones.
11 I got the underground river supply pod. No river appeared. Make sure you not only generate this in the backend, but draw
it. It becomes a permanent part of the map.
12 Building a base on enemy land is equivalent to starting an attack. Edit: looks like it's working, but corner case is
when you haven't met the faction yet. The warning popup appears, then no vendetta or even commlink is in drop-up. Is this
what I want?
13 Hitting W is still ending turn right now, if there was no one else to move. This is a big bug.



***************************************************************************

** Known Bugs **

***************************************************************************



Note: this is the ONLY section of todo.txt that can be edited by Claude Code, but only to add checkmarks to tasks.


1 Got a drone riot popup. Zoom to base did not pop up the base view.
2 FACTION_DATA contains single quotes and double quotes. Perhaps we should make consistent.
3 When certain non-combat units are on the same tile as military units, and another faction destroys all the military units,
the non-military units automatically die. This is true for probe teams, and all versions of colony pods. (And artifacts,
but they are captured, not killed. We've implemented this.) A note at the bottom should say We <killed or lost> x units.
4 AI colony pod keeps trying to build a base on a monolith, and gets denied, every turn. Needs an updated algo.
5 Growth is still messed up. It should not show two growth meters.
6 STILL not consistently showing new unit designs! This time it happened for Industrial Base, which I have seen pop
up new unit designs in several previous games.
7 A unit finally debarked from a transport, but it came out held. At NO point should a transported unit be held. The l
command is the l command. It means board transport. When you debark, you lose this status. I am also able to select the
held unit without the H disappearing. This should never happen! This was all solved already!!!
8 I debarked a unit onto a tile with a supply pod. I did not get the supply pod.
9 Boarded units on a transport are missing from the garrison pane in the console.
10 Units are no longer healing at all! Stop breaking fixed things!
11 Clicking on units in the garrison pane no longer selects them. It should! It was!!
12 Once again, when ending my turn on hitting a supply pod, the AI turns are already processing before I've cleared hit OK.
I'm not going to say which popup this was - ANY popup should keep the turn from auto-ending!
13 W is now cycling to held players again...
14 Supposed to allow a general Governor when clicking the center button, but right now only the 4x are possible.
15 Starting tile should be a tile on which a base can be built. I just started on a monolith.
16 Also skipped turn on my starting monolith with my land unit. No upgrade was performed.



***************************************************************************

** Possible Backward compatibility that can be removed: **

***************************************************************************


  ---
  hasattr() backwards compat guards in unit.py runtime methods (not even in from_dict):
  - get_morale_name, gain_experience, record_kill all have if not hasattr(self, 'experience'): blocks

  ---
  .get() with defaults throughout all from_dict methods (~50 instances):
  - base.py::from_dict — 24 .get() calls under an explicit # backward compatibility comment
  - game.py::from_dict — 12+ .get() calls
  - unit.py::from_dict — 16 .get() calls
  - map.py::from_dict — 3 .get() + a fungus format migration block
  - design_data.py::from_dict — 1 .get()

  ---
  Legacy method/attribute stubs:
  - map.py::set_fungus — docstring says "kept for backward compatibility"
  - base.py::self.garrison — comment says "legacy"
  - renderer.py — hasattr() check guarding morale rendering

  ---



***************************************************************************

** Biggest concepts we haven't even touched (and aren't in datalinks.md): **

***************************************************************************



1 Art
2 Sounds
3 Fog of war
4 Advanced unit movement (G command, J command, drag path)
5 Isometric
6 Diplomacy trees (it is half-built, but may need a redesign)