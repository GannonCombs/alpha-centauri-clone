***************************************************************************

** Beta test **

***************************************************************************


The following are features I added or bugs I fixed but haven't tested to ensure correctness.

✅ When subtask completed, erase when entire feature/bug has been confirmed working correctly.



Features:



1. I created a debug mode to be able to test anything.
Use it to test the following issues, but also test debug mode along the way.

2. Energy Allocation System
- Split energy production between Economy, Labs, and Psych ✅
- Economy → Energy reserves (treasury) ✅
- Labs → Research speed
- Psych → Talent creation (happiness)
- Adjustable slider/percentage allocation ✅

3. Psych, Drones, and Talents System
- Drones = unhappy citizens (appear based on difficulty and base size) ✅
- Talents = happy citizens (created via Psych allocation or facilities) ✅
- Drone Riots occur when Drones > Talents (production stops)
- Facilities like Recreation Commons reduce drones
- Police units can suppress drones (based on POLICE social engineering)

4. Unit Support & Maintenance
- Units cost minerals to support (based on SUPPORT social engineering)
- Free support levels (2 units per base by default)
- Exceeding support level drains minerals from production
- "Clean Reactor" ability eliminates support costs

5. Air Units & Fuel/Range
- Air units have limited range (must return to base/airbase)
- Range measured in turns from base
- Needlejets: 2 turn range, Copters: 1 turn range
- Airbases allow refueling
- Air superiority combat (+100% vs. air, -50% vs. ground)

6: Special Unit Abilities

- Clean Reactor: No support cost
- AAA Tracking: +100% vs air units
- Comm Jammer: +50% attack
- Blink Displacer: Ignores base defense
- Empath Song: +50% vs psi armor
- Framework ready for Cloaking, Drop Pods, Amphibious Pods, Fungal Payload

7. Probe Teams
- Infiltrate datalinks
- Steal technology
- Sabotage facilities
- Incite drone riots
- Mind control units/bases
- Success rate based on PROBE social engineering
- Every successful action leads to a morale upgrade, until Elite

8: Sea Transport & Loading

- Transport foils can carry up to 4 land units, Transport cruisers up to 8.
- Loaded units move with transport automatically
- Unload to adjacent land tiles
- Loaded units destroyed if transport is destroyed while not in base.
- When a unit is in a base along with a transport, press l to load them.

9: Disengage Mechanic

- Fast units can escape when damaged to 50% or less HP
- Requires 2+ movement advantage over opponent
- Success chance: 50% base + morale bonuses + speed bonuses
- Units retreat to safe adjacent tiles

10: Base Conquest (Disloyal Citizens)                                                              ─

- Captured bases have disloyal citizens for 50 turns
- Formula: 5 - (turns_since_capture // 10), capped by base size
- Extra drones make conquered bases harder to manage
- Works with both combat conquest and probe mind control

11: Planetary Council Proposals

- Added ALL proposals ✅
- Voting UI fully functional
- Effects implemented (some stubbed for future work)

12: Victory Conditions

- Conquest: Eliminate all enemies
- Diplomatic: Win vote for Supreme Leader
- Economic: 50k credits + Economic Victory project
- Transcendence: Complete Ascent to Transcendence

13: Artillery
- Right click
- Some hot key also activates

14: Remaining Faction bonuses to test
Faction: Deirdre
Bonus: fungus_nutrients: 1 — Get +1 nutrient per worked fungus tile
Location: calculate_resource_output
────────────────────────────────────────
Faction: Zakharov
Bonus: extra_drone_per_4 — +floor(pop/4) extra drones
Location: calculate_population_happiness
────────────────────────────────────────
Faction: Morgan
Bonus: hab_complex_limit: 4 — can't exceed pop 4 without hab complex
Location: _get_max_pop
────────────────────────────────────────
Faction: Lal
Bonus: hab_complex_bonus: 2 — +2 to all population caps
Location: _get_max_pop
The _get_max_pop now reads both hab_complex_limit (replaces default 7) and hab_complex_bonus
(additive to all tiers), so Morgan caps at 4 / 14, and Lal caps at 9 / 16.

15 Once we get the commlink of every living faction, give a popup that we now have them all, and thus can now call council.

16 If another unit gets all contacts first, they may call council. Add to the AI behavior that encourages them to call things
that they like. Examples: remove atrocity prohibitions if their faction is warlike, elect governor if they are a candidate, etc.

17: Artifacts
- If an artifact walks onto a square that is adjacent to an enemy, a popup occurs that the artifact was stolen. Ok button.
The artifact transports to the title the unit was on.
- If an artifact is on the same title as a military unit, and another faction kills that unit, the artifact gets taken
in similar fashion. Note that if the tile has multiple units on it, the artifact stays put. Only transfers on the last death.
- If an artifact moves onto a supply pod, both artifact and pod are consumed. No tech comes of it. Have a popup saying
the artifact was destroyed. Ok button only.
- If an artifact is held in a base with an unlinked Network Node, a popup occurs, asking if we'd like to link it.
If yes, the artifact is consumed and we get a free tech. Linking means a network node can only consume one artifact ever.

18: Bonus techs
- The first person to discover any of the three techs starting with "Secrets of" get another tech right after.



Bugs:



1 My diplomatic statuses have disappeared as turns pass. It now shows nothing. Speaking to the factions, it's clear this
is not just a bug in display. I'm able to propose treaties and pacts all over again. Obv, these should persist.
2 A scout patrol of mine attacked and won. The next turn, it was still Already Moved. This should never happen.
3 A unit of mine took a base and wasn't healed. Any unit taking a base automatically fully heals.
4 Saw an AI unit on an island tile it couldn't have walked to, before getting a transport. They were on the bottom row
of the map; are there invisible tiles there that are playable?
5 Got a diplomatic milestone popup when missing commlinks.
6 Healing should not occur at turn end. It happens in upkeep of the next turn.
7 Production times are off. Merchant Exchange takes 20 turns on Turn 1 for Morgan.
8 Healing isn't working correctly. It's applying the bonuses correctly, but when the units are moving. It should only
be when they've skipped their turn entirely. If a unit has even partially moved or acted that turn, healing doesn't happen
naturally (movement onto a monolith is the exception.)
9 Turn auto-ended when the last unit moved into contact with a new faction. End turn needs to wait for diplomacy to finish.
The End Turn button should then blink, not auto-end.
10 Still a bug where 3 or 4 factions get eliminated on turn 1. Nothing attacked them. Just a bug.
11 When an AI faction meets me for the first time and wants to talk, the AI turns keep processing in the background. This
should not be the case. Everything should pause until the conversation is over.
12 Supply pod commlink auto-started a call. Should just add contact to commlink panel silently.
13 Alien artifact in base with network node — no popup appeared. Now triggers on unit selection.
    Updated popup: "What would you like to do?" with "Link to Network Node" / "Keep for later".
14 Applied Physics (laser) not generating new unit designs. Bug: no armor available → best_armor=None
    caused creation guard to fail. Now always creates no-armor offensive variants for land/sea.
15 Transport design auto-created transport infantry. Only sea chassis now get transport weapon designs.
16 'l' key to board transport did nothing — K_l handler was missing. Now boards transport on same tile.
17 Unit panel: added "Cargo: x/y" line for sea transports.
18 Land unit in sea base could walk directly to adjacent land tile. Now blocked unless amphibious pods.
19 The selecting and de-selecting of the tiles the base works in the mini-map is broken. De-selection should not automatically
re-select. The user will click once to de-select, and click a non-worked tile to select. The user can also de-select multiple
tiles in a row before selecting new ones.
20 I got the underground river supply pod. No river appeared. Make sure you not only generate this in the backend, but draw
it. It becomes a permanent part of the map. Also, where you have "Xenofungus" in pink in the terrain pane, could you do a
similar thing for "River", drawing it the same light blue as the river?



***************************************************************************

** Known Bugs **

***************************************************************************



Note: this is the ONLY section of todo.txt that can be edited by Claude Code, but only to add checkmarks to tasks.


1 Got a drone riot popup. Zoom to base did not popup the base view.
2 FACTION_DATA contains single quotes and double quotes. Perhaps we should make consistent.
3 When I'm surprise attacked, another popup appears for each Pact brother or sister I have, saying, "On behalf of your
 pact, <pactbors> has pronounced on <attacker>!"
4 When certain non-combat units are on the same tile as military units, and another faction destroys all the military units,
the non-military units automatically die. This is true for probe teams, and all versions of colony pods. (And artifacts,
but they are captured, not killed. We've implemented this.) A note at the bottom should say We <killed or lost> x units.
5 AI colony pod keeps trying to build a base on a monolith, and gets denied, every turn. Needs an updated algo.
6 Found a base mini-map that isn't accurate. It's pretending there's a row of green land beneath it that isn't there.
The base is founded on the bottom row, so that might be affecting it. Also, the minimap should show our new land type additions,
including fungus, arid land, and rocks, but isn't.
7 Growth is still messed up. It should not show two growth meters, especially disagreeing ones.


***************************************************************************

** Biggest concepts we haven't even touched (and aren't in datalinks.md): **

***************************************************************************



1 Art
2 Sounds
3 Fog of war
4 Advanced unit movement (G command, J command, drag path)
5 Isometric
6 Diplomacy trees (it is half-built, but may need a redesign)
7 Secret Project view