We have faction data in data.py. Some of this is set (title), some is dynamic (votes)
We have faction data in individual files in flavorText. Mostly text filler.

Do these need to combine?

There is also non-faction data in data.py (voting proposals)


High level flow of dialog triggering:
(expand this as I get more info)

1 Try to move a unit: game.try_move_unit(self, unit, target_x, target_y).
 - Poorly named. It DOES move a unit if it can.
2 After it moves, but still within try_move_unit, we call game._check_first_contact.
3 Within, we set game.pending_commlink_requests. Each entry in this list contains player_id and other_faction_id.
 - Study if the gathering of ids makes sense.
 - Fishy smell: self.faction_contacts.append(other_faction_id)
 - other_faction_id is pulled from faction_assignments. We look up the id from the faction name, which we had from other_unit.owner. Fishy name.
 - Note: what SHOULD be the main index be for looking up opponents?
 - Fishy smell: # Check if we have all living factions now
 - This looks, at the very least, duplicated unnecessarily. But it might be in the wrong function.
4 ui_manager.draw checks if it needs to draw a commlink request popup.
5 If it does, ui_manager._draw_commlink_request draws a dialog box that says "x is requesting to speak with you." "A representative wishes to open communications."
6 Clicking Answer triggers this conditional earlier in ui_manager: if self.commlink_request_answer_rect and self.commlink_request_answer_rect.collidepoint(pos):
 - This opens up the diplomacy view, I think: self.active_screen = "DIPLOMACY"

 - Note the values passed in. It's getting an other_faction_id.
 - Ok there's something possibly weird going on here. pending_commlink_requests is an array, because you can meet multiple new factions with one move. It's happened.
 - But when we pass it in, we store the data globally. Is this necessary? In some order...
 - On line 886 of ui_manager.draw, we store the two ids.
 - The global variable is used in ui_manager._draw_commlink_request
 - The global variable is used when Answer is clicked
 - So it definitely looks weird that the pop (and loss of data) is occurring right next to where most of the ids are being used. But maybe we can't pass the data through.
 - Line 379 is REALLY smelly. Even if the two ids DO need to be global, this looks wrong. TODO: Solve this.

 - Other fishy smell: self.diplomacy.diplo_stage = "greeting"
 - This sets diplo_stage in the ui_manager. I can't see any need for this in ui_manager, or anywhere it's used.
7 These are passed to diplomacy.open_diplomacy.
  - This seems to only set variables.
 - Other diplomacy.py functions? TBD. TODO: Solve this.
 - Trace backwards from below to try to connect the dots.
8 commlink_dialogs.py functions (set_config, get_dialog)
 -get_dialog()...gets dialog
 -set_context()...sets the context (meaning flavor text)
 - Remember, commlink_dialogs ONLY sets the flavor text (and main text?). (TODO: rename the file). Diplomacy handles the flow.
 - TODO: We should always segregate data files from functional files. Split up commlink_dialogs.
 - (Which then raises the question, can the funcs in commlink_dialogs be moved to diplomacy.py?
 - Tangent: there are several other files that need to be segregated.



Also, bug currently: line 890, in draw
    self.commlink_request_other_faction_id = request['faction_id']
KeyError: 'faction_id'